<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BEAST Composer</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <script src="https://unpkg.com/react/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@material-ui/core/umd/material-ui.production.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script>
      const { AppBar, Drawer, List, ListItem, ListItemIcon, ListItemText, makeStyles, Toolbar, Typography } = MaterialUI;
      const { render } = ReactDOM;

      const drawerWidth = 240; // Define drawer width as a constant

      const useStyles = makeStyles({
        root: {
          display: 'flex',
        },
        appBar: {
          zIndex: 1,
        },
        drawer: {
          width: drawerWidth,
          flexShrink: 0,
        },
        drawerPaper: {
          width: drawerWidth,
        },
        content: {
          flexGrow: 1,
          padding: 20,
          marginTop: 50,
        },
        connectionStatusConnected: {
          flexGrow: 1,
          textAlign: "center",
          backgroundColor: "green",
          position: "absolute",
          top: 10,
          right: 10,
          width: 120,
          height: 30,
          paddingTop: 10,
          border: "1px solid black",
        },
        connectionStatusDisconnected: {
          flexGrow: 1,
          textAlign: "center",
          backgroundColor: "red",
          position: "absolute",
          top: 10,
          right: 10,
          width: 120,
          height: 30,
          paddingTop: 10,
          border: "1px solid black",
        },
      });

      function getHomeContent() {
        return "Welcome Home!";
      }

      function App() {
        const classes = useStyles();

        const [content, setContent] = React.useState(getHomeContent());
        const [title, setTitle] = React.useState('Home');

        const [data, setData] = React.useState(null);
        const [error, setError] = React.useState(null);

        const [connected, setConnected] = React.useState(false)

        React.useEffect(() => {
          const fetchData = async () => {
            try {
              const response = await fetch('/api/v1/status');
              if (!response.ok) {
                throw new Error('Network response was not ok');
              }
              const jsonData = await response.json();
              // Process the returned data
              setData(jsonData);
              setError(null); // Reset error state if successful
            } catch (error) {
              setError(error.message); // Set error state if unsuccessful
            }
          };
          fetchData();
          const interval = setInterval(() => {
            fetchData();
          }, 5000); // Fetch data every 5 seconds
          return () => clearInterval(interval);
        }, []);

        const handlePipelinesClick = () => {
          setContent('You have no pipelines');
          setTitle('Pipelines');
        };

        const handleProgramCollectionClick = () => {
          setContent('You have no program collection');
          setTitle('Program Collection');
        };

        return (
          React.createElement("div", { className: classes.root },
            React.createElement(AppBar, { position: "fixed", className: classes.appBar },
              React.createElement(Toolbar, { style: { marginLeft: `${drawerWidth + 10}px` } },
                React.createElement(Typography, { variant: "h6" }, title),
                React.createElement(Typography, { variant: "h8", className: connected ? classes.connectionStatusConnected : classes.connectionStatusDisconnected}, connected ? 'Connected' : 'Disconnected')
              )
            ),
            React.createElement(Drawer, {
                className: classes.drawer,
                variant: "permanent",
                classes: {
                  paper: classes.drawerPaper,
                }
              },
              React.createElement(List, null,
                React.createElement(ListItem, { button: true, onClick: handlePipelinesClick },
                  React.createElement(ListItemIcon, null,
                    React.createElement("i", { className: "material-icons" }, "lan")
                  ),
                  React.createElement(ListItemText, { primary: "Pipelines" })
                ),
                React.createElement(ListItem, { button: true, onClick: handleProgramCollectionClick },
                  React.createElement(ListItemIcon, null,
                    React.createElement("i", { className: "material-icons" }, "hive")
                  ),
                  React.createElement(ListItemText, { primary: "Program Collection" })
                )
              )
            ),
            React.createElement("main", { className: classes.content },
              React.createElement("p", null, content)
            )
          )
        );
      }

      render(React.createElement(App), document.getElementById("root"));
    </script>
  </body>
</html>
